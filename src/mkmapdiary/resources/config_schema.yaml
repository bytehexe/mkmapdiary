# JSON Schema for mkmapdiary configuration (in YAML format)
# Note: Do not use "required" properties here, as this schema
# is also used to validate partial configurations.
#
# Default config for the schema: src/mkmapdiary/resources/defaults.yaml
#
$schema: "http://json-schema.org/draft-07/schema#"
title: "mkmapdiary Configuration Schema"
description: "Schema for validating mkmapdiary configuration files"
type: object

definitions:
  customString:
    oneOf:
      - type: string
      - type: "null"
    description: "Custom string override (can be string or null)"

  llmPrompt:
    type: object
    properties:
      translation_key:
        type: string
        description: "Translation key for the prompt template"
      model:
        type: string
        description: "LLM model to use for this prompt"
      prompt:
        type: string
        description: "Prompt template"
      options:
        type: object
        description: "Options for the LLM model"
        additionalProperties: true
    additionalProperties: false

properties:
  features:
    type: object
    description: "Feature configuration settings"
    properties:
      transcription:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable transcription feature. Use !auto for automatic detection."
        additionalProperties: false

      llms:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable LLM features"
          text_model:
            type: string
            description: "Text model to use for LLM operations"
        additionalProperties: false

      geo_correlation:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable geo correlation"
          time_offset:
            type: integer
            description: "Time offset in seconds (use !duration tag for human-readable format)"
          max_time_diff:
            type: integer
            description: "Maximum time difference for correlation in seconds (use !duration tag for human-readable format)"
        additionalProperties: false

      poi_detection:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable POI detection"
          max_age:
            type: integer
            description: "Maximum age for POI data in seconds (use !duration tag for human-readable format)"
          priorities:
            type: object
            description: "Symbol priorities for POI detection"
            additionalProperties: false
            patternProperties:
              "^.*$":
                type: ["integer", "null"]
                description: "Priority value for the POI symbol (integer) or null to disable"

        additionalProperties: false

      iqa:
        type: object
        properties:
          method:
            type: string
            enum: ["clipiqa", "simple"]
            description: "IQA method to use. Use !auto for automatic detection."
          threshold:
            type: number
            description: "Threshold for 'clipiqa' method"
          stddev_factor:
            type: number
            description: "Standard deviation factor for 'simple' method"
        additionalProperties: false

      entropy_filtering:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable entropy filtering"
          threshold:
            type: number
            description: "Entropy threshold for filtering"
        additionalProperties: false

      gpsbabel_import:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable gpsbabel import. Use !auto for automatic detection."
          formats:
            type: object
            description: "Supported GPS data file formats"
            additionalProperties:
              type: string
        additionalProperties: false

      track_simplification:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable track simplification. Use !auto for automatic detection."
          tolerance:
            type: number
            description: "Tolerance for track simplification in meters (use !distance tag for human-readable format)"
        additionalProperties: false

    additionalProperties: false

  site:
    type: object
    description: "Site configuration settings"
    properties:
      image_format:
        type: string
        description: "Output image format"
      image_options:
        type: object
        description: "Image processing options"
        additionalProperties: true
      locale:
        type: string
        description: "Site locale. Use !auto for automatic detection."
      timezone:
        type: string
        description: "Timezone setting. Use !auto for automatic detection."
    additionalProperties: false

  debug:
    type: object
    description: "Debug configuration settings"
    properties:
      enable_user_cache:
        type: boolean
        description: "Enable or disable user cache for debugging"
    additionalProperties: false

  strings:
    type: object
    description: "Custom translation strings"
    properties:
      journal_title:
        $ref: "#/definitions/customString"
      site_name:
        $ref: "#/definitions/customString"
      map_title:
        $ref: "#/definitions/customString"
      days_title:
        $ref: "#/definitions/customString"
      audio_title:
        $ref: "#/definitions/customString"
      text_title:
        $ref: "#/definitions/customString"
      gallery_title:
        $ref: "#/definitions/customString"
      home_title:
        $ref: "#/definitions/customString"
      generate_title_prompt:
        $ref: "#/definitions/customString"
      generate_tags_prompt:
        $ref: "#/definitions/customString"
      summarize_journal_entry_prompt:
        $ref: "#/definitions/customString"
      summarize_image_prompt:
        $ref: "#/definitions/customString"
      assess_image_quality_prompt:
        $ref: "#/definitions/customString"
    additionalProperties: false

  llm_prompts:
    type: object
    description: "LLM prompt templates configuration"
    properties:
      generate_title:
        $ref: "#/definitions/llmPrompt"
      generate_tags:
        $ref: "#/definitions/llmPrompt"
      summarize_journal_entry:
        $ref: "#/definitions/llmPrompt"
      summarize_image:
        $ref: "#/definitions/llmPrompt"
      assess_image_quality:
        $ref: "#/definitions/llmPrompt"
    additionalProperties: false

additionalProperties: false
