# JSON Schema for mkmapdiary configuration (in YAML format)
# Note: Do not use "required" properties here, as this schema
# is also used to validate partial configurations.
#
# Default config for the schema: src/mkmapdiary/resources/defaults.yaml
#
$schema: "http://json-schema.org/draft-07/schema#"
title: "mkmapdiary Configuration Schema"
description: "Schema for validating mkmapdiary configuration files"
type: object

definitions:
  customString:
    oneOf:
      - type: string
      - type: "null"
    description: "Custom string override (can be string or null)"

  llmPrompt:
    type: object
    properties:
      translation_key:
        type: string
        description: "Translation key for the prompt template"
      model:
        type: string
        description: "LLM model to use for this prompt"
      prompt:
        type: string
        description: "Prompt template"
      options:
        type: object
        description: "Options for the LLM model"
        additionalProperties: true
    additionalProperties: false

properties:
  input_formats:
    type: object
    description: "Input format configuration settings"
    properties:
      gpsbabel:
        type: object
        properties:
          formats:
            type: object
            description: "Supported GPS data file formats"
            additionalProperties:
              anyOf:
                - type: "string"
                - type: "null"
              description: "Format name to pass to gpsbabel, or null to disable"
        additionalProperties: false
      raw:
        type: object
        properties:
          formats:
            type: object
            description: "Supported raw image file formats"
            additionalProperties:
              anyOf:
                - type: "string"
                - type: "null"
              description: "Format name to pass to libraw, or null to disable"

    additionalProperties: false

  features:
    type: object
    description: "Feature configuration settings"
    properties:
      cr2:
        type: object
        properties:
          use_thumbnail:
            type: boolean
            description: "Use embedded thumbnail for CR2 images if available"
        additionalProperties: false

      transcription:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable transcription feature. Use !auto for automatic detection."
        additionalProperties: false

      llms:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable LLM features"
          text_model:
            type: string
            description: "Text model to use for LLM operations"
        additionalProperties: false

      geo_correlation:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable geo correlation"
          time_offset:
            type: integer
            description: "Time offset in seconds (use !duration tag for human-readable format)"
          max_time_diff:
            type: integer
            description: "Maximum time difference for correlation in seconds (use !duration tag for human-readable format)"
        additionalProperties: false

      poi_detection:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable POI detection"
          max_age:
            type: integer
            description: "Maximum age for POI data in seconds (use !duration tag for human-readable format)"
          priorities:
            type: object
            description: "Symbol priorities for POI detection"
            additionalProperties: false
            patternProperties:
              "^.*$":
                type: ["integer", "null"]
                description: "Priority value for the POI symbol (integer) or null to disable"

        additionalProperties: false

      iqa:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable image quality assessment"
          method:
            type: string
            enum: ["clipiqa", "simple"]
            description: "IQA method to use. Use !auto for automatic detection."
          threshold:
            type: number
            description: "Threshold for 'clipiqa' method"
          stddev_factor:
            type: number
            description: "Standard deviation factor for 'simple' method"
        additionalProperties: false

      image_comparison:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable image comparison feature"
        additionalProperties: false

      entropy_filtering:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable entropy filtering"
          threshold:
            type: number
            description: "Entropy threshold for filtering"
        additionalProperties: false

      track_simplification:
        type: object
        properties:
          enabled:
            type: boolean
            description: "Enable or disable track simplification"
          tolerance:
            type: number
            description: "Tolerance for track simplification in meters (use !distance tag for human-readable format)"
        additionalProperties: false

    additionalProperties: false

  site:
    type: object
    description: "Site configuration settings"
    properties:
      image_format:
        type: string
        description: "Output image format"
      image_options:
        type: object
        description: "Image processing options"
        additionalProperties: true
      locale:
        type: string
        description: "Site locale. Use !auto for automatic detection."
      timezone:
        type: string
        description: "Timezone setting. Use !auto for automatic detection."
    additionalProperties: false

  debug:
    type: object
    description: "Debug configuration settings"
    properties:
      enable_user_cache:
        type: boolean
        description: "Enable or disable user cache for debugging"
    additionalProperties: false

  ignore_dates:
    type: array
    description: "List of dates to ignore (skip day pages and GPX generation)"
    items:
      type: date
      description: "Date in yyyy-mm-dd format (YAML auto-parses to datetime.date)"
    default: []

  strings:
    type: object
    description: "Custom translation strings"
    properties:
      journal_title:
        $ref: "#/definitions/customString"
      site_name:
        $ref: "#/definitions/customString"
      map_title:
        $ref: "#/definitions/customString"
      days_title:
        $ref: "#/definitions/customString"
      audio_title:
        $ref: "#/definitions/customString"
      text_title:
        $ref: "#/definitions/customString"
      gallery_title:
        $ref: "#/definitions/customString"
      home_title:
        $ref: "#/definitions/customString"
      generate_title_prompt:
        $ref: "#/definitions/customString"
      generate_tags_prompt:
        $ref: "#/definitions/customString"
      summarize_journal_entry_prompt:
        $ref: "#/definitions/customString"
      summarize_image_prompt:
        $ref: "#/definitions/customString"
      assess_image_quality_prompt:
        $ref: "#/definitions/customString"
      zoom_to_fit:
        $ref: "#/definitions/customString"
      download_gpx:
        $ref: "#/definitions/customString"
      legend_track:
        $ref: "#/definitions/customString"
      legend_waypoints:
        $ref: "#/definitions/customString"
      legend_activity_areas:
        $ref: "#/definitions/customString"
      legend_journal_entries:
        $ref: "#/definitions/customString"
      overview_title:
        $ref: "#/definitions/customString"
      include_duplicates:
        $ref: "#/definitions/customString"
      include_low_quality:
        $ref: "#/definitions/customString"
      show_quality_icons:
        $ref: "#/definitions/customString"
      quality_good:
        $ref: "#/definitions/customString"
      quality_bad:
        $ref: "#/definitions/customString"
      quality_excellent:
        $ref: "#/definitions/customString"
      quality_low_entropy:
        $ref: "#/definitions/customString"
      quality_duplicate:
        $ref: "#/definitions/customString"
      quality_canonical:
        $ref: "#/definitions/customString"
      track_label:
        $ref: "#/definitions/customString"
      track_distance:
        $ref: "#/definitions/customString"
      track_elevation_gain:
        $ref: "#/definitions/customString"
      track_elevation_loss:
        $ref: "#/definitions/customString"
      track_time_moving:
        $ref: "#/definitions/customString"
      track_total_time:
        $ref: "#/definitions/customString"
    additionalProperties: false

  llm_prompts:
    type: object
    description: "LLM prompt templates configuration"
    properties:
      generate_title:
        $ref: "#/definitions/llmPrompt"
      generate_tags:
        $ref: "#/definitions/llmPrompt"
      summarize_journal_entry:
        $ref: "#/definitions/llmPrompt"
      summarize_image:
        $ref: "#/definitions/llmPrompt"
      assess_image_quality:
        $ref: "#/definitions/llmPrompt"
    additionalProperties: false

additionalProperties: false
